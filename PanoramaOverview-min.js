/*! PanoOverview v2.0.1 | (c) 2014, 2014  */
!function(){var a={};a.mix=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.hasOwnProperty(c)||(a[c]=b[c]));return a},a.setCssSprite=function(a,b,c){b&&(a.style.backgroundImage="url("+b+")"),c&&(a.style.backgroundPosition=-c[0]+"px "+-c[1]+"px")};var b=111319.49077777778;a.latFromProjectionTo4326=function(a){var c=a/b;return c=114.59155902616465*Math.atan(Math.exp(.017453292519943295*c))-90},a.lngFromProjectionTo4326=function(a){return a/b},a.doubleBounds=function(a){var b=a.getNorthEast(),c=a.getSouthWest(),d=c.getLng(),e=c.getLat(),f=b.getLng(),g=b.getLat(),h=(f-d)/2,i=(g-e)/2;d-=h,f+=h,e-=i,g+=i;var j=new qq.maps.LatLngBounds(new qq.maps.LatLng(e,d),new qq.maps.LatLng(g,f));return j},a.Loader=function(){var a="_SOSOMapPluginLoader",b=window[a]={},c=0;function d(){return"cb"+(new Date).getTime().toString(36)+(c++).toString(36)}function e(c,e){var f=d();b[f]=function(a){e&&e(a)};var g=document.createElement("script");g.async="async",g.setAttribute("type","text/javascript"),g.setAttribute("charset","gbk");var h=["output=jsonp","fr=mapPlugin","cb="+a+"."+f],i=c+(-1===c.indexOf("?")?"?":"&")+h.join("&");g.src=i;var j=document.head||document.getElementsByTagName("head")[0]||document.documentElement;g.onload=g.onreadystatechange=function(a,c){(c||!g.readyState||/loaded|complete/.test(g.readyState))&&(b[f]=null,g.onload=g.onreadystatechange=null,j&&g.parentNode&&j.removeChild(g),g=void 0)},j.insertBefore(g,j.firstChild)}return{send:e}}();var c="http://api.map.soso.com/plugin/v2/PanoramaOverview/image/camera_region.png";function d(){this.icons=[{normal:[23,22],hover:[27,24],normalIamgeCoord:[2,63],hoverIamgeCoord:[32,63]},{normal:[19,17],hover:[23,21],normalIamgeCoord:[3,42],hoverIamgeCoord:[28,42]},{normal:[17,15],hover:[21,19],normalIamgeCoord:[3,22],hoverIamgeCoord:[26,22]},{normal:[15,13],hover:[29,17],normalIamgeCoord:[3,3],hoverIamgeCoord:[24,3]}],qq.maps.Overlay.apply(this,arguments)}var e=d.prototype=new qq.maps.Overlay;e.visible_changed=function(){this.draw()},e.setVisible=function(a){this.set("visible",a)},e.getVisible=function(){return this.get("visible")},e.setPoi=function(a){this.poi=a,this.draw()},e.construct=function(){var a=document.createElement("div");this.getPanes().overlayShadow.appendChild(a);var b=document.createElement("div"),c=this.get("map");this.getPanes().floatPane.appendChild(b);var d=this;this._hClick=qq.maps.event.addDomListener(b,"click",function(){d._onClick()}),this._hMouseOver=qq.maps.event.addDomListener(b,"mouseover",function(){d._onMouseOver()}),this._hMouseOut=qq.maps.event.addDomListener(b,"mouseout",function(){d._onMouseOut()}),this._hMouseDown=qq.maps.event.addDomListener(b,"mousedown",function(){d._onMouseDown()}),this._hMouseUp=qq.maps.event.addDomListener(b,"mouseup",function(){d._onMouseUp()}),this._div=a,this._hitDiv=b},e._resetImageCon=function(){var b=this._div,d=this._getIcon();return b.style.cssText="position:absolute;width:"+d.normal[0]+"px;height:"+d.normal[1]+"px;z-index:500;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;",a.setCssSprite(b,c,d.normalIamgeCoord),b},e._resetHitCon=function(){var a=this._getIcon(),b=this._hitDiv;return b.style.cssText="position:absolute;width:"+a.normal[0]+"px;height:"+a.normal[1]+"px;background-image:url(about:blank);z-index:700;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;",b},e._onClick=function(a){if(!this.isDragging){this.get("map")._svid=this.poi.svid;var b=this.get("panorama");b&&b.setPano(this.poi.svid)}this.isDragging=!1,this._mapDragging&&(qq.maps.event.removeListener(this._mapDragging),delete this._mapDragging)},e._onMouseDown=function(a){var b=this;this.get("map")._svid=this.poi.svid,this._center=this.get("map").getCenter(),this._mapDragging||(this._mapDragging=qq.maps.event.addListener(this.get("map"),"dragging",function(){var a=b.get("map").getCenter();(b._center.getLat()!=a.getLat()||b._center.getLng()!=a.getLng())&&(b.isDragging=!0)}))},e._onMouseUp=function(a){this.get("map")._svid=this.isDragging?"":this.poi.svid,this.isDragging=!1,this._mapDragging&&(qq.maps.event.removeListener(this._mapDragging),delete this._mapDragging)},e._onMouseOver=function(){var b=this._getIcon();this._div.style.zIndex="550",this._hitDiv.style.zIndex="750",this._hitDiv.style.width=b.hover[0]+"px",this._div.style.width=b.hover[0]+"px",this._hitDiv.style.height=b.hover[1]+"px",this._div.style.height=b.hover[1]+"px",a.setCssSprite(this._div,c,b.hoverIamgeCoord),this._hitDiv.style.top=parseInt(this._hitDiv.style.top)-0+"px",this._hitDiv.style.left=parseInt(this._hitDiv.style.left)-0+"px",this._div.style.top=parseInt(this._div.style.top)-0+"px",this._div.style.left=parseInt(this._div.style.left)-0+"px"},e._onMouseOut=function(){var b=this._getIcon();this._div.style.zIndex="500",this._hitDiv.style.zIndex="700",this._hitDiv.style.width=b.normal[0]+"px",this._hitDiv.style.height=b.normal[1]+"px",this._div.style.width=b.normal[0]+"px",this._div.style.height=b.normal[1]+"px",this._hitDiv.style.top=parseInt(this._hitDiv.style.top)+0+"px",this._hitDiv.style.left=parseInt(this._hitDiv.style.left)+0+"px",this._div.style.top=parseInt(this._div.style.top)+0+"px",this._div.style.left=parseInt(this._div.style.left)+0+"px",a.setCssSprite(this._div,c,b.normalIamgeCoord)},e._getIcon=function(){var a=this.get("map"),b=a.getZoom(),c=19-b;return c=Math.min(c,3),this.icons[c]},e.destroy=function(){this._div&&(qq.maps.event.removeListener(this._hClick),qq.maps.event.removeListener(this._hMouseOver),qq.maps.event.removeListener(this._hMouseOut),qq.maps.event.removeListener(this._hMouseDown),qq.maps.event.removeListener(this._hMouseUp),this._div.parentNode.removeChild(this._div),this._hitDiv.parentNode.removeChild(this._hitDiv),this._div=null,this._hitDiv=null),this._mapDragging&&(qq.maps.event.removeListener(this._mapDragging),delete this._mapDragging)},e.draw=function(){var a=this.get("map");if(this._div&&this.poi&&a){var b=this._getIcon(),c=this.poi,d=this._div.style,e=this._hitDiv.style;this._resetImageCon(),this._resetHitCon(),e.display=d.display=this.get("visible")?"":"none";var f=this.getProjection().fromLatLngToDivPixel(c.latlng);e.left=d.left=parseInt(f.getX()-b.normal[0]/2)+"px",e.top=d.top=parseInt(f.getY()-b.normal[1]/2)+"px",d.left=d.left=parseInt(f.getX()-b.normal[0]/2)+"px",d.top=d.top=parseInt(f.getY()-b.normal[1]/2)+"px",c&&c.n&&(this._hitDiv.title=c.n),this._hitDiv.svid=c.svid||""}};var f="http://sv.map.qq.com/rsvids",g={iconSize:[14,12],map:null,netBounds:[123152e-9,.00016093254],level:18,_voidResult:[],voidResult:[],hoverMarkers:{},viewBounds:null,waitQuene:[],inited:!1,init:function(a,b){var c=b[0],d=this.netBounds;delete this.hoverMarkers,this.hoverMarkers=[];for(var e=0;e<a.length;e++){var f=a[e],g=this.getIndex(f.latlng,b,d);this.hoverMarkers[g.col]||(this.hoverMarkers[g.col]=[]),this.hoverMarkers[g.col][g.row]||(this.hoverMarkers[g.col][g.row]=[]),this.hoverMarkers[g.col][g.row].push(f)}this.viewBounds=b,this.inited=!0;for(var e=0;e<this.waitQuene.length;e++)this.waitQuene[e]&&this.waitQuene[e]()},getIndex:function(a,b,c){var d=a.getLat(),e=a.getLng(),f=c[0],g=c[1],h=Math.floor((e-b[0])/g),i=Math.floor((d-b[1])/f);return{col:h,row:i}},getVoidMarkerByBounds:function(a){for(var b=this._boundsToPoint(a),c=this.netBounds,d=b[1],e=b[3],f=this.getIndex(e,this.viewBounds,c),g=this.getIndex(d,this.viewBounds,c),h=f.col>0?f.col:0,i=g.col,j=f.row>0?f.row:0,k=g.row,l=this.map.getZoom(),m=[],n=[],o=h;i>=o;o++)for(var p=j;k>=p;p++)if(this.hoverMarkers[o]&&this.hoverMarkers[o][p])for(var q=0;q<this.hoverMarkers[o][p].length;q++){var r=Math.floor(p/Math.pow(2,this.level-l)),s=Math.floor(o/Math.pow(2,this.level-l));m[s]&&m[s][r]||(m[s]||(m[s]=[]),m[s][r]=this.hoverMarkers[o][p][q],n.push(this.hoverMarkers[o][p][q]))}return n},_boundsToPoint:function(a){var b=a.getSouthWest().getLng(),c=a.getSouthWest().getLat(),d=a.getNorthEast().getLng(),e=a.getNorthEast().getLat(),f=new qq.maps.LatLng(c,b),g=new qq.maps.LatLng(e,b),h=new qq.maps.LatLng(c,d),i=new qq.maps.LatLng(e,d);return[g,i,h,f]}};function h(a){this.icon={},this._markers={},this.bindsTo(["panorama","planeInfo"],a),this.model=a}var i=h.prototype=new qq.maps.MVCObject;i.clearCameraMarkers=function(){for(var a in this._markers)this._markers[a].setMap(null),this._markers[a]=null,delete this._markers[a];this._markers={}},i._renderHoverMarkers=function(a){for(var b=this.get("map"),c={},e=0;e<a.length;e++){var f=a[e],g;this._markers[f.svid]?(g=this._markers[f.svid],this._markers[f.svid]=null,delete this._markers[f.svid]):(g=new d({panorama:this.get("panorama"),visible:!0}),g.setPoi(f),g.setMap(b)),c[f.svid]=g}for(var h in this._markers)this._markers[h].setMap(null),this._markers[h]=null,delete this._markers[h];this._markers=c},i._requestPoisByPlaneId=function(){var b=this.get("planeInfo"),c=b.regionId;if(c){var d=[f,"?region_id=",c].join(""),e=this;a.Loader.send(d,function(c){var d=e.get("map");if(d&&c&&c.info){var f=c.info,h=f.svids,i=[];if(h){for(var j=0;j<h.length;j++){var k=h[j];0!=parseInt(k.x)&&0!=parseInt(k.y)&&(k.x=a.lngFromProjectionTo4326(k.x),k.y=a.latFromProjectionTo4326(k.y),k.latlng=d.__convertor.to(new qq.maps.LatLng(k.y,k.x),0),k.svid=k.id,i.push(k))}g.init(i,b.bounds)}}})}},i.map_changed=function(){var a=this.get("map");if(g.map=a,a){if(!this._hMapIdle||!this._hMapMove){this.bindTo("zoom",a);var b=this;this._hMapIdle=qq.maps.event.addListener(a,"idle",function(a){b._onMapIdle()}),setTimeout(function(){b._onMapIdle()})}}else this.unbind("zoom"),this._hMapIdle&&(qq.maps.event.removeListener(this._hMapIdle),this._hMapIdle=null),this.clearCameraMarkers()},i._getBoundsPois=function(){var b=this.get("map");if(b){var c=a.doubleBounds(b.getBounds()),d=this;if(g.inited){var e=g.getVoidMarkerByBounds(c);d._renderHoverMarkers(e)}else g.waitQuene.push(function(){var a=g.getVoidMarkerByBounds(c);d._renderHoverMarkers(a)})}},i._onMapIdle=function(){this._getBoundsPois()},i.planeInfo_changed=function(){var a=this.get("planeInfo");try{if(a){this.set("map",this.model.get("map"));var b=a.regionId,c=this.get("planeId");b&&c!==b&&(this.planeId=b,this._requestPoisByPlaneId(b),this.set("planeId",b))}else this.set("map",null)}catch(d){console.log(d)}},i.zoomLevel_changed=function(){if(g.inited){var b=this.get("map"),c=a.doubleBounds(b.getBounds()),d=g.getVoidMarkerByBounds(c),e={};this._renderHoverMarkers(d)}};var j="http://sv0.map.qq.com/rchart/";function k(a,b){var c=a.x,d=a.y;d=(1<<b+Math.floor(.5))-1-d;var e=[layerOpts.domain,layerOpts.hash,"/",layerOpts.regionId,"/",b,"/",Math.floor(c/16),"/",Math.floor(d/16),"/",c,"_",d,".png"].join("");return e}var l={alt:"\u5e73\u9762\u56fe",name:"\u5e73\u9762\u56fe",tileSize:new qq.maps.Size(256,256),getTileUrl:k},m={forwordMatrix:null,backMatrix:null,init:function(a,b){this.isArray(a)||(a=this.to33Arr(a)),this.isArray(b)||(b=this.to33Arr(b)),this.forwordMatrix=a,this.backMatrix=b},to:function(a,b){var c=this,d=a.getLat(),e=a.getLng(),f=c.forwordMatrix;b&&(f=c.backMatrix);var g=e*f[0][0]+d*f[0][1]+1*f[0][2],h=e*f[1][0]+d*f[1][1]+1*f[1][2];return new qq.maps.LatLng(h,g)},headingTo:function(a){var b=this,c=b.forwordMatrix;if(!a&&0!==a||!b.forwordMatrix)return a;var d=[Math.sin(a/180*Math.PI),Math.cos(a/180*Math.PI),1],e=d[0]*c[0][0]+d[1]*c[0][1],f=d[0]*c[1][0]+d[1]*c[1][1];return a=this.getHeading(0,0,e,f)},getHeading:function(a,b,c,d){var e={x:c-a,y:d-b};this.normalize(e);var f={x:0,y:1},g=180*Math.acos(this.dotProduct(e,f))/Math.PI;return this.crossProduct(f,e)>0&&(g=360-g),g},dotProduct:function(a,b){return a.x*b.x+a.y*b.y},crossProduct:function(a,b){return a.x*b.y-a.y*b.x},verctorLength:function(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))},normalize:function(a){var b=this.verctorLength(a);b&&(a.x=a.x/b,a.y=a.y/b)},to33Arr:function(a){a=a.split(",");for(var b=[[],[],[]],c=0,d=0;9>c;c++)c%3==0&&0!==c&&d++,b[d].push(a[c]);return b},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)}};function n(b){qq.maps.MVCObject.apply(this);var c={map:null,planeId:null,panorama:null};c=a.mix(c,b),this.setValues(c),this.bgPoi=new h(this)}n.prototype=new qq.maps.MVCObject;var o=n.prototype;o.panorama_changed=function(){var a=["planeInfo"];this.unbindAll(a),this.get("panorama")&&this.bindsTo(a,this.get("panorama"))},o.map_changed=function(){var a=this.get("map");a&&this._resetMap()},o._resetMap=function(){var a=this.get("planeInfo"),b=this.get("map");if(a&&b){layerOpts=this.get("planeInfo");var c=layerOpts.bounds[0],d=layerOpts.bounds[1],e=layerOpts.bounds[2],f=layerOpts.bounds[3],g=new qq.maps.LatLngBounds(new qq.maps.LatLng(d,c),new qq.maps.LatLng(f,e));layerOpts.domain=j,layerOpts.boundary=g,layerOpts.hash=layerOpts.regionId.split("-")[0];var h=layerOpts.forwardMatrix,i=layerOpts.backwardMatrix;if(m.init(h,i),b.setOptions({boundary:g,minZoom:layerOpts.minZoom,maxZoom:layerOpts.maxZoom,zoomLevel:layerOpts.zoomLevel}),!b.mapTypes.get(layerOpts.regionId)){l.minZoom=layerOpts.minZoom,l.maxZoom=layerOpts.maxZoom;var k=new qq.maps.ImageMapType(l);b.mapTypes.set(layerOpts.regionId,k)}b.isPlane=!0,b.__convertor=m,b.setMapTypeId(layerOpts.regionId)}else b&&(b.setMapTypeId(qq.maps.MapTypeId.ROADMAP),b.setOptions({boundary:null,minZoom:1,maxZoom:18,zoomLevel:15}),b.isPlane=!1,b.__convertor=null),layerOpts=void 0},o.planeInfo_changed=function(){var a;return function(){var b=this.get("planeInfo")||{};(!a||a&&a.regionId!=b.regionId)&&(this._resetMap(),a=layerOpts)}}(),o.convertLatLngToPlane=function(a){return m.to(a,0)},o.convertLatLngToEarth=function(a){return m.to(a,1)},o.planeId_changed=function(){var b=this,c=this.get("planeId");if(c){var d="http://sv.map.soso.com/reginfo?rid="+c;a.Loader.send(d,function(a){if(a&&a.detail){var d=a.detail,e={regionId:c,bounds:[parseFloat(d.minx),parseFloat(d.miny),parseFloat(d.maxx),parseFloat(d.maxy)],minZoom:parseInt(d.min_zoom),maxZoom:parseInt(d.max_zoom),zoomLevel:parseInt(d.best_chart_level||0),forwardMatrix:d.forward_matrix||"",center:new qq.maps.LatLng(parseFloat(d.centery),parseFloat(d.centerx)),backwardMatrix:d.backward_matrix||""};b.set("planeInfo",e)}})}};function p(a){this.maskMarker=new qq.maps.Marker({icon:this.getMaskIcon(),clickable:!1,draggable:!0}),this.marker=new qq.maps.Marker({icon:this.getMaskIcon(),clickable:!1,draggable:!1}),this.model=a;var b=["map","pov","position"];this.bindsTo(b,a),this.initMarkListener()}p.prototype=new qq.maps.MVCObject;var q=p.prototype;q.initMarkListener=function(){var a=qq.maps.event,b=this;a.addListener(this.maskMarker,"dragging",function(a){b.marker.setPosition(a.latLng)}),a.addListener(this.maskMarker,"dragend",function(a){b.model.goTo(a.latLng)})},q.pov_changed=function(){var a=this.get("pov")||{};if(this.get("pov")){var b=a.heading,c=this.getScoutIconByHeading(b);c!==this.get("icon")&&this.set("icon",c)}},q.icon_changed=function(){var a=this.get("icon");a&&this.marker&&(this.marker.setIcon(a),a.shape&&this.marker.setShape(a.shape))},q.position_changed=function(){var a=this.get("position")||null,b=this.get("map");b&&b.__convertor&&(a=b.__convertor.to(a,0)),this.marker.setPosition(a),this.maskMarker.setPosition(a)},q.map_changed=function(){var a=this.get("map")||null;this.marker.setMap(a),this.maskMarker.setMap(a)},q.setModel=function(a){this.unbindAll(keyAttr),a?this.bindsTo(keyAttr,a):(this.marker.setMap(null),this.maskMarker.setMap(null))},q.getScoutIconByHeading=function(){var a="http://s.map.soso.com/themes/default/img/street/3D_People.png?v=v3.3.916",b=new qq.maps.Size(138,96),c=new qq.maps.Point(69,27),d=null;return function(e){if(null==d){d=[];for(var f=0;12>f;f++){var g=new qq.maps.MarkerShape([58,0,80,36],"rect"),h=new qq.maps.MarkerImage(a,b,new qq.maps.Point(0,138*f+42),c);h.shape=g,d.push(h)}}e||(e=0);var i=this.get("map");i&&i.__convertor&&(e=i.__convertor.headingTo(e));var j=Math.round(e/30)%12;return d[j]}}(),q.getMaskIcon=function(){var a="http://s.map.soso.com/themes/blank.gif?v=v3.3.916",b=new qq.maps.MarkerShape([0,0,22,36],"rect"),c=new qq.maps.Size(22,36),d=new qq.maps.Point(11,27),e=new qq.maps.MarkerImage(a,c,new qq.maps.Point(0,0),d);return e.shape=b,e};var r=[200,200,200,200,300,400,500,600,1e3,3e3,6e3,12e3,25e3,5e4,1e5];function s(b){b=b||{};var c={panorama:null,map:null,visible:!0};b=a.mix(b,c),this.planeMap=new n,this.setValues(b)}s.prototype=new qq.maps.MVCObject,s.prototype.notifyResize=function(){qq.maps.event.trigger(this,"resize")},s.prototype.getMap=function(){return this.get("map")},s.prototype.setContainer=function(a){this.set("container",a),this.draw()},s.prototype.planeInfo_changed=function(a){var b=this.get("planeInfo");b?(this.set("pov",this.get("pov")),this.panoramaLayer&&this.panoramaLayer.setMap(null)):this.panoramaLayer&&this.get("map")&&this.panoramaLayer.setMap(this.get("map"))},s.prototype.setPanorama=function(a){this.set("panorama",a),this.draw(),this.planeMap.set("panorama",a)},s.prototype.setMap=function(a){this.set("map",a),this.draw(),this.planeMap.set("map",a)},s.prototype.draw=function(){var a=this.get("map"),b=this.get("panorama");a&&b?(this._initMapListener(),this._createScout(),this._bindsToPanorama()):this.destroy()},s.prototype._createMap=function(){var a=this.get("map"),b=this.get("position"),c=this.get("container");if(c){var d=document.createElement("div");c.appendChild(d),d.style.cssText="width:100%;height:100%;position:relative;",this.set("mapCon",d),a||(a=new qq.maps.Map(d,{__hideLogo__:!0,draggableCursor:"pointer",isMini:!0,minZoom:4,maxZoom:18,zoom:15}),this.set("map",a),this.planeMap.set("map",a)),b&&a.setCenter(b)}},s.prototype._initMapListener=function(){var a=this.get("map"),b=this;qq.maps.event.addListener(a,"click",function(a){var c=a.latLng;b.goTo(c)})},s.prototype.goTo=function(a){var b=this.get("map"),c=this;if(b&&b.__convertor&&(a=b.__convertor.to(a,1)),a){var d=b.getZoom(),e=r[18-d];c._goTo(a,e)}},s.prototype._createLayer=function(){var a=this.panoramaLayer;a||(this.panoramaLayer=new qq.maps.PanoramaLayer({map:this.get("map")}),this.panoramaLayer.setMap(this.get("map")))},s.prototype._createScout=function(){this.scout||(this.scout=new p(this))},s.prototype._goTo=function(a,b){var c=this;this.panoramaService||(this.panoramaService=new qq.maps.PanoramaService),this.panoramaService.getPano(a,b,function(a){if(a&&a.svid){var b=c.get("panorama");b&&b.setPano(a.svid)}else{var b=c.get("panorama");c.scout.set("position",b.get("position"))}})},s.prototype.destroy=function(){var a=["pov","position"];this.unbindAll(a),this.scout&&(this.scout.setModel(null),delete this.scout);var b=this.get("mapCon");this.set("mapCon",null),this.set("map",null)},s.prototype._bindsToPanorama=function(){var a=this.get("panorama"),b=["pov","position","planeInfo"];this.unbindAll(b),a&&this.bindsTo(b,a)},s.prototype.position_changed=function(){var a=this.get("position"),b=this.get("map");a&&a.lat&&a.lng&&b&&(b&&b.__convertor&&(a=b.__convertor.to(a,0)),b.setCenter(a))},qq.maps.PanoOverview=s}();
//# sourceMappingURL=streetMiniMap.min.map